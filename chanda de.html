<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ ‡¶¶‡ßá - ‡¶´‡¶æ‡¶∏‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap');
        
        body {
            margin: 0;
            overflow: hidden;
            background: #09090b;
            font-family: 'Hind Siliguri', sans-serif;
            touch-action: none;
        }
        canvas { display: block; }
        .menu-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; text-align: center; padding: 20px; color: white;
            backdrop-filter: blur(15px);
        }
        .btn-main {
            background: #fbbf24;
            color: #000;
            font-weight: 900;
            padding: 15px 50px;
            border-radius: 60px;
            font-size: 1.5rem;
            border: 4px solid #fff;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.5);
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-main:active { transform: scale(0.9); }
        
        #bubble-msg {
            position: absolute;
            bottom: 35%; left: 50%;
            transform: translateX(-50%);
            background: #fff; color: #000;
            padding: 15px 30px; border-radius: 25px;
            font-weight: bold; display: none; z-index: 150;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            pointer-events: none;
            font-size: 1.2rem;
            border: 4px solid #fbbf24;
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            0% { transform: translateX(-50%) scale(0); opacity: 0; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="bubble-msg">‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ ‡¶¶‡ßá!</div>

    <!-- Start Menu -->
    <div id="start-menu" class="menu-overlay">
        <h1 class="text-6xl font-black text-yellow-400 mb-4 italic">‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ ‡¶¶‡ßá!</h1>
        <p class="text-white text-lg mb-8 font-bold bg-red-600 px-6 py-2 rounded-lg shadow-lg">‡¶Æ‡¶æ‡¶Æ‡¶æ, ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞ ‡¶®‡¶æ‡¶≤‡ßá ‡¶ñ‡¶¨‡¶∞ ‡¶Ü‡¶õ‡ßá!</p>
        <button id="start-btn" class="btn-main">‡¶ñ‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶á üïπÔ∏è</button>
        <p class="mt-4 text-gray-400 italic text-sm">‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≠‡¶≤‡¶ø‡¶â‡¶Æ ‡¶¨‡¶æ‡ßú‡¶ø‡ßü‡ßá ‡¶®‡¶æ‡¶ì ‡¶Æ‡¶æ‡¶Æ‡¶æ!</p>
        <p class="mt-2 text-yellow-500 font-bold">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ó = ‡ß´‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ üí∞</p>
    </div>

    <!-- Game Over Menu -->
    <div id="game-over-menu" class="menu-overlay hidden">
        <div class="bg-zinc-900 p-10 rounded-3xl border-8 border-yellow-500 mb-8 shadow-2xl">
            <h2 class="text-3xl font-black text-white mb-2">‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂‡ßá ‡¶ß‡¶∞‡¶õ‡ßá! üëÆ‚Äç‚ôÇÔ∏è</h2>
            <p class="text-yellow-500 text-6xl font-black mb-4"><span id="final-money">0</span> ‡ß≥</p>
            <p class="text-white text-xl font-bold italic bg-red-500 px-4 py-2 rounded-lg shadow-lg">‡¶Æ‡¶æ‡¶Æ‡¶æ, ‡¶ß‡¶∞‡¶æ ‡¶ñ‡¶æ‡ßü‡¶æ ‡¶∏‡¶¨ ‡¶π‡¶æ‡¶∞‡¶æ‡¶á‡¶≤‡¶ø!</p>
        </div>
        <button class="btn-main" onclick="initGame()">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ ‡¶§‡ßã‡¶≤</button>
    </div>

    <!-- UI -->
    <div id="game-ui" class="absolute top-10 left-0 w-full flex justify-between px-8 pointer-events-none hidden text-white z-50">
        <div class="bg-black/70 p-4 rounded-2xl border-2 border-yellow-500/40 backdrop-blur-md">
            <div class="text-3xl font-black text-yellow-400">üí∞ <span id="money-count">0</span> ‡ß≥</div>
            <div class="text-sm text-red-400 font-bold mt-1">‡¶ó‡¶§‡¶ø: <span id="speed-val">9</span>x</div>
        </div>
        <div class="bg-black/70 p-4 rounded-2xl h-fit border-2 border-white/20 backdrop-blur-md text-xs">‡¶∏‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ: <span id="high-score">0</span> ‡ß≥</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('start-btn');
        const startMenu = document.getElementById('start-menu');
        const gameOverMenu = document.getElementById('game-over-menu');
        const moneyDisplay = document.getElementById('money-count');
        const bubbleMsg = document.getElementById('bubble-msg');
        const speedValDisplay = document.getElementById('speed-val');

        let audioCtx;
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playEffect(type) {
            if (!audioCtx) return;
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const now = audioCtx.currentTime;

                if (type === 'pop') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                    gain.gain.setValueAtTime(0.3, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'jump') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(150, now);
                    osc.frequency.exponentialRampToValueAtTime(600, now + 0.2);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                } else if (type === 'coin') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                }
            } catch(e) { console.log("Audio play failed"); }
        }

        function speak(text, rate = 1.3, showBubble = true) {
            if (!window.speechSynthesis) return;
            
            if (showBubble) {
                bubbleMsg.innerText = text;
                bubbleMsg.style.display = 'block';
            }
            
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'bn-BD';
            utterance.rate = rate;
            window.speechSynthesis.speak(utterance);
            
            if (showBubble) {
                setTimeout(() => { 
                    if(bubbleMsg.innerText === text) bubbleMsg.style.display = 'none'; 
                }, 2000);
            }
        }

        let isRunning = false;
        let totalMoney = 0, speed = 9, highMoney = 0;
        let gameTime = 0;
        let player = { x: 0, y: 0, lane: 1, dy: 0, isJumping: false };
        let obstacles = [], collectibles = [], lanes = [];

        const funMessages = [
            "‡¶Æ‡¶æ‡¶Æ‡¶æ ‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®‡ßá!",
            "‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶™‡¶ø‡¶õ‡ßá!",
            "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ó‡ßÅ‡¶≤‡¶æ ‡¶§‡ßã‡¶≤ ‡¶Æ‡¶æ‡¶Æ‡¶æ!",
            "‡¶Ü‡¶∏‡ßç‡¶§‡ßá ‡¶ö‡¶æ‡¶≤‡¶æ‡¶ì ‡¶ì‡¶∏‡ßç‡¶§‡¶æ‡¶¶!",
            "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ó ‡¶ó‡ßÅ‡¶≤‡¶æ ‡¶ß‡¶∞!",
            "‡¶Æ‡¶æ‡¶Æ‡¶æ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶Ü‡¶Æ‡¶æ‡¶∞!",
            "‡¶π‡ßá‡¶¨‡ßç‡¶¨‡¶ø ‡¶ñ‡ßá‡¶≤‡¶§‡ßá‡¶õ‡ßã!",
            "‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶∞‡ßá‡¶® ‡¶∂‡ßÅ‡¶®‡¶≤‡¶ø?",
            "‡¶Æ‡¶æ‡¶Æ‡¶æ ‡¶¨‡ßç‡¶∞‡ßá‡¶ï ‡¶ï‡¶á?",
            "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡¶æ ‡¶®‡¶ø‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡¶ø ‡¶ï‡¶á?"
        ];

        // Canvas initialization fix
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const w = Math.min(canvas.width * 0.28, 140);
            lanes = [canvas.width/2 - w, canvas.width/2, canvas.width/2 + w];
            player.y = canvas.height * 0.82;
            player.x = lanes[player.lane];
        }

        window.addEventListener('resize', resize);
        // Call resize immediately to avoid black screen
        resize();

        function initGame() {
            initAudio();
            speak("‡¶Æ‡¶æ‡¶Æ‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞!", 1.3);
            isRunning = true;
            totalMoney = 0; speed = 9; gameTime = 0;
            obstacles = []; collectibles = [];
            player.lane = 1;
            moneyDisplay.innerText = totalMoney;
            speedValDisplay.innerText = speed;
            startMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            resize(); // Ensure lanes are calculated when game starts
        }

        startBtn.onclick = initGame;

        const handleInput = (dir) => {
            if (!isRunning) return;
            if (dir === 'left' && player.lane > 0) {
                player.lane--;
                playEffect('pop');
            }
            if (dir === 'right' && player.lane < 2) {
                player.lane++;
                playEffect('pop');
            }
            if (dir === 'jump' && !player.isJumping) {
                player.dy = -24;
                player.isJumping = true;
                playEffect('jump');
            }
        };

        window.addEventListener('keydown', e => {
            if (e.code === 'ArrowLeft') handleInput('left');
            if (e.code === 'ArrowRight') handleInput('right');
            if (e.code === 'Space' || e.code === 'ArrowUp') handleInput('jump');
        });

        // Touch improvements
        canvas.addEventListener('touchstart', e => {
            if (!isRunning) return;
            const tx = e.touches[0].clientX;
            if (tx < canvas.width * 0.3) handleInput('left');
            else if (tx > canvas.width * 0.7) handleInput('right');
            else handleInput('jump');
        }, {passive: false});

        function update() {
            if (!isRunning) return;
            gameTime++;

            if (gameTime % 480 === 0 && Math.random() > 0.3) {
                const randomMsg = funMessages[Math.floor(Math.random() * funMessages.length)];
                speak(randomMsg, 1.3, true);
            }

            if (gameTime % 3600 === 0) {
                speed += 1.5;
                speedValDisplay.innerText = Math.floor(speed);
                speak("‡¶ó‡¶§‡¶ø ‡¶¨‡¶æ‡ßú‡¶õ‡ßá!", 1.2);
            }

            if (player.isJumping) {
                player.y += player.dy;
                player.dy += 1.2;
                if (player.y >= canvas.height * 0.82) {
                    player.y = canvas.height * 0.82;
                    player.isJumping = false;
                }
            }
            player.x += (lanes[player.lane] - player.x) * 0.25;

            let spawnRate = 0.025 + (speed * 0.001);
            if (Math.random() < spawnRate) {
                obstacles.push({ x: lanes[Math.floor(Math.random()*3)], y: -100 });
            }
            if (Math.random() < 0.01) {
                collectibles.push({ x: lanes[Math.floor(Math.random()*3)], y: -100 });
            }

            obstacles.forEach((obs, i) => {
                obs.y += speed;
                if (Math.abs(obs.x - player.x) < 40 && Math.abs(obs.y - player.y) < 50 && !player.isJumping) {
                    endGame();
                }
                if (obs.y > canvas.height + 100) obstacles.splice(i, 1);
            });

            collectibles.forEach((col, i) => {
                col.y += speed;
                if (Math.abs(col.x - player.x) < 50 && Math.abs(col.y - player.y) < 50) {
                    totalMoney += 50; 
                    moneyDisplay.innerText = totalMoney;
                    playEffect('coin');
                    collectibles.splice(i, 1);
                }
                if (col.y > canvas.height + 100) collectibles.splice(i, 1);
            });
        }

        function endGame() {
            isRunning = false;
            if(totalMoney > highMoney) {
                highMoney = totalMoney;
                document.getElementById('high-score').innerText = highMoney;
            }
            speak("‡¶Æ‡¶æ‡¶Æ‡¶æ, ‡¶ß‡¶∞‡¶æ ‡¶ñ‡¶æ‡ßü‡¶æ ‡¶∏‡¶¨ ‡¶π‡¶æ‡¶∞‡¶æ‡¶á‡¶≤‡¶ø!", 1.1, false);
            document.getElementById('final-money').innerText = totalMoney;
            gameOverMenu.classList.remove('hidden');
        }

        function drawPolice(x, y) {
            ctx.save();
            ctx.translate(x, y);
            ctx.fillStyle = "#1e3a8a"; ctx.fillRect(-25, -10, 50, 45);
            ctx.fillStyle = "#fdba74"; ctx.beginPath(); ctx.arc(0, -25, 18, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#1e3a8a"; ctx.beginPath(); ctx.moveTo(-22, -35); ctx.lineTo(22, -35); ctx.lineTo(28, -45); ctx.lineTo(-28, -45); ctx.closePath(); ctx.fill();
            ctx.fillStyle = "#000"; ctx.fillRect(-10, -22, 20, 3);
            ctx.fillStyle = (Math.floor(Date.now()/200) % 2 === 0) ? "#ef4444" : "#1e40af"; ctx.fillRect(-25, -15, 8, 8);
            ctx.fillStyle = (Math.floor(Date.now()/200) % 2 === 0) ? "#1e40af" : "#ef4444"; ctx.fillRect(17, -15, 8, 8);
            ctx.restore();
        }

        function drawPlayer(x, y) {
            ctx.save();
            ctx.translate(x, y);
            // Simple Player Design
            ctx.fillStyle = "#3b82f6"; ctx.fillRect(-20, -15, 40, 40);
            ctx.fillStyle = "#fdba74"; ctx.beginPath(); ctx.arc(0, -30, 18, 0, Math.PI*2); ctx.fill();
            ctx.restore();
        }

        function drawMoneyBag(x, y) {
            const time = Date.now() / 200;
            const pulse = 1 + Math.sin(time) * 0.1;
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(pulse, pulse);
            ctx.fillStyle = "#fbbf24"; ctx.beginPath(); ctx.arc(0, 5, 20, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#b45309"; ctx.fillRect(-10, -15, 20, 8);
            ctx.fillStyle = "#000"; ctx.font = "900 20px Arial"; ctx.textAlign = "center"; ctx.fillText("‡ß≥", 0, 12);
            ctx.restore();
        }

        function draw() {
            ctx.fillStyle = "#09090b";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Road Draw
            if (lanes.length > 0) {
                const roadWidth = lanes[2] - lanes[0] + 180;
                ctx.fillStyle = "#18181b";
                ctx.fillRect(canvas.width/2 - roadWidth/2, 0, roadWidth, canvas.height);
                
                // Lane lines
                ctx.strokeStyle = "rgba(251,191,36,0.15)"; 
                ctx.setLineDash([40, 40]); 
                ctx.lineWidth = 4;
                ctx.beginPath(); 
                ctx.moveTo(lanes[0] + 70, 0); ctx.lineTo(lanes[0] + 70, canvas.height); 
                ctx.moveTo(lanes[1] + 70, 0); ctx.lineTo(lanes[1] + 70, canvas.height); 
                ctx.stroke();
            }

            collectibles.forEach(col => drawMoneyBag(col.x, col.y));
            obstacles.forEach(obs => drawPolice(obs.x, obs.y));
            drawPlayer(player.x, player.y);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        window.onload = () => {
            resize();
            loop();
        };
    </script>
</body>
</html>